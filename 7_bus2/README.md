# Linux内核总线注册示例

这个示例演示了Linux内核中总线的注册流程，包括总线类型的定义、注册和属性的创建。

## 组件说明

本示例包含一个总线模块：

**my_bus.c** - 总线模块，演示如何注册一个自定义总线类型，包括：
- 定义总线匹配函数
- 定义总线probe和remove函数
- 创建总线属性文件
- 注册和卸载总线

## 总线注册流程

1. **定义总线匹配函数** - 决定驱动和设备如何配对
2. **定义总线级回调函数** - 处理总线级别的初始化和清理
3. **定义总线属性及其操作函数** - 提供对总线的可见属性
4. **注册总线** - 使用`bus_register()`将总线注册到系统
5. **创建总线属性文件** - 使用`bus_create_file()`创建属性文件

## 编译和安装

### 编译模块
```bash
make
```

### 加载模块
```bash
insmod my_bus.ko
```

### 查看总线信息
总线加载后，可以通过以下命令查看总线及其属性：
```bash
ls -l /sys/bus/my_bus/
cat /sys/bus/my_bus/bus
```

### 卸载模块
```bash
rmmod my_bus
```

## 文件系统结构

模块加载后，会在sysfs中创建以下文件结构：
```
/sys/bus/my_bus/       - 总线目录
├── bus                - 总线属性文件
├── devices/           - 总线上的设备目录（当前为空）
└── drivers/           - 总线上的驱动目录（当前为空）
```

## 扩展说明

当前示例仅演示了总线注册部分。为了完整展示总线的功能，后续可以添加设备和驱动模块：
1. 设备模块 - 创建设备并注册到自定义总线
2. 驱动模块 - 注册一个驱动到自定义总线

这将展示总线匹配函数在设备和驱动配对中的作用，以及probe和remove函数的调用流程。

## 许可证

GPL 